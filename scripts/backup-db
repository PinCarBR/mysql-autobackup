#!/bin/bash

BACKUP_FOLDER=/opt/mysql/backup
NOW=$(date +'%Y-%m-%dT%H%M%SZ')
TAIL_SIZE=$(($MYSQL_BACKUP_HIST_SIZE+2))
[ ! -d $BACKUP_FOLDER ] && mkdir --parents $BACKUP_FOLDER
PREFIX=$MYSQL_BACKUP_PREFIX
DEST=$BACKUP_FOLDER/$PREFIX
LAST=$DEST-$NOW
xtrabackup \
    --user=$MYSQL_USER \
    --password=$MYSQL_PASSWORD \
    --host=$MYSQL_HOST \
    --port=$MYSQL_PORT \
    --backup \
    --target-dir=$LAST
tar -zcvf $LAST.tar.gz $LAST
